@page
@model zEVRental.RazorWebApp.CuongCLA.Pages.PaymentCuongClas.DeleteModel

@{
    ViewData["Title"] = "Delete Payment";
}

<!-- Custom CSS -->
<style>
    .page-header {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        padding: 2.5rem 0;
        margin-bottom: 3rem;
        border-radius: 0 0 2rem 2rem;
        position: relative;
        overflow: hidden;
    }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 100" fill="white" opacity="0.1"><path d="M0,0v46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1047.81,18.38,1000,0V0Z"/></svg>') center/cover;
        }

    .delete-container {
        background: white;
        border-radius: 1.5rem;
        box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
        border: 1px solid #ffebee;
    }

    .warning-indicator {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        animation: pulse 2s infinite;
    }

    @@keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); }
        100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); }
    }

    .delete-header {
        background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
        padding: 2rem;
        border-bottom: 1px solid #f8bbd9;
        position: relative;
        text-align: center;
    }

        .delete-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border-radius: 2px;
        }

    .delete-icon {
        font-size: 4rem;
        color: #e74c3c;
        margin-bottom: 1rem;
        animation: shake 0.5s ease-in-out infinite alternate;
    }

    @@keyframes shake {
        0% { transform: translateX(0); }
        100% { transform: translateX(5px); }
    }

    .delete-title {
        color: #e74c3c;
        font-weight: 700;
        font-size: 1.8rem;
        margin-bottom: 0.5rem;
    }

    .delete-subtitle {
        color: #666;
        font-size: 1.1rem;
        margin-bottom: 0;
    }

    .delete-body {
        padding: 2.5rem;
    }

    .warning-box {
        background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
        border: 1px solid #ffeaa7;
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
    }

        .warning-box i {
            font-size: 2rem;
            color: #856404;
            margin-right: 1rem;
        }

        .warning-box .warning-text {
            flex: 1;
        }

            .warning-box .warning-text h5 {
                color: #856404;
                font-weight: 600;
                margin-bottom: 0.5rem;
            }

            .warning-box .warning-text p {
                color: #856404;
                margin-bottom: 0;
                font-size: 0.95rem;
            }

    .payment-summary {
        background: #f8f9fa;
        border-radius: 1rem;
        padding: 1.5rem;
        border-left: 4px solid #e74c3c;
        margin-bottom: 2rem;
    }

    .summary-header {
        font-size: 1.1rem;
        font-weight: 600;
        color: #495057;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
    }

        .summary-header i {
            margin-right: 0.75rem;
            color: #e74c3c;
        }

    .summary-row {
        display: flex;
        margin-bottom: 1rem;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #e9ecef;
    }

        .summary-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

    .summary-label {
        font-weight: 600;
        color: #495057;
        min-width: 180px;
        display: flex;
        align-items: center;
    }

        .summary-label i {
            margin-right: 0.5rem;
            color: #6c757d;
            width: 16px;
        }

    .summary-value {
        color: #212529;
        flex: 1;
        font-weight: 500;
    }

    .payment-id {
        background: #e9ecef;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        font-family: 'Courier New', monospace;
        font-weight: 600;
        color: #495057;
        display: inline-block;
        margin-bottom: 1rem;
    }

    .amount-highlight {
        font-size: 1.25rem;
        font-weight: 700;
        color: #e74c3c;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.4rem 0.8rem;
        border-radius: 50px;
        font-size: 0.875rem;
        font-weight: 600;
    }

    .status-completed { background: #d1ecf1; color: #0c5460; }
    .status-pending { background: #fff3cd; color: #856404; }
    .status-failed { background: #f8d7da; color: #721c24; }
    .status-cancelled { background: #d6d8db; color: #383d41; }
    .status-refunded { background: #cce7ff; color: #004085; }

    .deposit-indicator {
        background: #fff3cd;
        color: #856404;
        padding: 0.25rem 0.75rem;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 0.5rem;
    }

    .related-info {
        background: white;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #dee2e6;
    }

    .delete-actions {
        background: #f8f9fa;
        padding: 2rem;
        border-top: 1px solid #dee2e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .btn-action {
        padding: 0.75rem 2rem;
        border-radius: 0.75rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        border: none;
        cursor: pointer;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .btn-delete {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        box-shadow: 0 0.25rem 0.75rem rgba(231, 76, 60, 0.3);
    }

        .btn-delete:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1.5rem rgba(231, 76, 60, 0.4);
            color: white;
            text-decoration: none;
        }

        .btn-delete:active {
            transform: translateY(0);
        }

    .btn-cancel {
        background: #6c757d;
        color: white;
    }

        .btn-cancel:hover {
            background: #5a6268;
            color: white;
            text-decoration: none;
            transform: translateY(-1px);
        }

    .breadcrumb {
        background: none;
        padding: 0;
        margin: 0;
    }

    .breadcrumb-item a {
        color: white;
        text-decoration: none;
        opacity: 0.8;
        transition: opacity 0.3s ease;
    }

        .breadcrumb-item a:hover {
            opacity: 1;
        }

    .breadcrumb-item.active {
        color: white;
        opacity: 1;
    }

    .confirmation-checkbox {
        margin: 1.5rem 0;
        padding: 1rem;
        background: white;
        border-radius: 0.5rem;
        border: 2px solid #e9ecef;
        transition: all 0.3s ease;
    }

        .confirmation-checkbox:hover {
            border-color: #e74c3c;
        }

        .confirmation-checkbox input[type="checkbox"] {
            transform: scale(1.2);
            margin-right: 0.75rem;
        }

        .confirmation-checkbox label {
            font-weight: 500;
            color: #495057;
            margin: 0;
            cursor: pointer;
        }

    @@media (max-width: 768px) {
        .delete-body {
            padding: 1.5rem;
        }

        .summary-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .summary-label {
            min-width: auto;
            margin-bottom: 0.5rem;
        }

        .delete-actions {
            flex-direction: column;
            text-align: center;
        }

        .page-header {
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }
    }
</style>

<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a asp-page="Index"><i class="fas fa-home me-1"></i>Payment Management</a>
                        </li>
                        <li class="breadcrumb-item active">Delete Payment</li>
                    </ol>
                </nav>
                <h1 class="mb-0">
                    <i class="fas fa-trash-alt me-3"></i>
                    Delete Payment Record
                </h1>
                <p class="mb-0 mt-2 opacity-75">Permanently remove payment from the system</p>
            </div>
            <div class="col-md-4 text-md-end">
                <div class="d-flex align-items-center justify-content-md-end">
                    <i class="fas fa-exclamation-triangle fa-3x opacity-25"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">
            <div class="delete-container">
                <div class="warning-indicator">
                    <i class="fas fa-exclamation me-2"></i>
                    Danger Zone
                </div>

                <div class="delete-header">
                    <div class="delete-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2 class="delete-title">Confirm Deletion</h2>
                    <p class="delete-subtitle">This action cannot be undone</p>
                    <div class="payment-id">
                        <i class="fas fa-hashtag me-2"></i>
                        Payment ID: @Model.PaymentCuongCla.PaymentCuongClaid
                    </div>
                </div>

                <div class="delete-body">
                    <!-- Warning Message -->
                    <div class="warning-box">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="warning-text">
                            <h5>Warning: Permanent Deletion</h5>
                            <p>You are about to permanently delete this payment record. This action cannot be reversed and all associated data will be lost forever.</p>
                        </div>
                    </div>

                    <!-- Payment Summary -->
                    <div class="payment-summary">
                        <h5 class="summary-header">
                            <i class="fas fa-file-invoice-dollar"></i>
                            Payment Summary
                        </h5>

                        <div class="summary-row">
                            <div class="summary-label">
                                <i class="fas fa-calendar-alt"></i>
                                Payment Date
                            </div>
                            <div class="summary-value">
                                @Model.PaymentCuongCla.PaymentDate.ToString("dddd, MMMM dd, yyyy 'at' h:mm tt")
                            </div>
                        </div>

                        <div class="summary-row">
                            <div class="summary-label">
                                <i class="fas fa-dollar-sign"></i>
                                Amount
                            </div>
                            <div class="summary-value">
                                <span class="amount-highlight">$@Model.PaymentCuongCla.Amount.ToString("N2")</span>
                                @if (Model.PaymentCuongCla.IsDeposit)
                                {
                                    <span class="deposit-indicator">Deposit</span>
                                }
                            </div>
                        </div>

                        <div class="summary-row">
                            <div class="summary-label">
                                <i class="fas fa-credit-card"></i>
                                Payment Method
                            </div>
                            <div class="summary-value">
                                @Model.PaymentCuongCla.PaymentMethod
                            </div>
                        </div>

                        <div class="summary-row">
                            <div class="summary-label">
                                <i class="fas fa-check-circle"></i>
                                Status
                            </div>
                            <div class="summary-value">
                                <span class="status-badge @(Model.PaymentCuongCla.PaymentStatus?.ToLower() == "completed" ? "status-completed" : 
                                                           Model.PaymentCuongCla.PaymentStatus?.ToLower() == "pending" ? "status-pending" : 
                                                           Model.PaymentCuongCla.PaymentStatus?.ToLower() == "failed" ? "status-failed" : 
                                                           Model.PaymentCuongCla.PaymentStatus?.ToLower() == "cancelled" ? "status-cancelled" : 
                                                           Model.PaymentCuongCla.PaymentStatus?.ToLower() == "refunded" ? "status-refunded" : "status-pending")">
                                    @Model.PaymentCuongCla.PaymentStatus
                                </span>
                            </div>
                        </div>

                        <div class="summary-row">
                            <div class="summary-label">
                                <i class="fas fa-shield-alt"></i>
                                Deposit Payment
                            </div>
                            <div class="summary-value">
                                @(Model.PaymentCuongCla.IsDeposit ? "Yes" : "No")
                            </div>
                        </div>

                        @if (Model.PaymentCuongCla.Booking?.Customer != null)
                        {
                            <div class="summary-row">
                                <div class="summary-label">
                                    <i class="fas fa-user"></i>
                                    Customer
                                </div>
                                <div class="summary-value">
                                    <div class="related-info">
                                        <strong>@Model.PaymentCuongCla.Booking.Customer.FullName</strong><br>
                                        <small class="text-muted">Booking ID: @Model.PaymentCuongCla.Booking.BookingCuongClaid</small>
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.PaymentCuongCla.ProcessedByNavigation != null)
                        {
                            <div class="summary-row">
                                <div class="summary-label">
                                    <i class="fas fa-user-cog"></i>
                                    Processed By
                                </div>
                                <div class="summary-value">
                                    <div class="related-info">
                                        <strong>@Model.PaymentCuongCla.ProcessedByNavigation.Email</strong>
                                        @if (!string.IsNullOrEmpty(Model.PaymentCuongCla.ProcessedByNavigation.FullName))
                                        {
                                            <br><small class="text-muted">@Model.PaymentCuongCla.ProcessedByNavigation.FullName</small>
                                        }
                                    </div>
                                </div>
                            </div>
                        }

                        @if (Model.PaymentCuongCla.DepositReturnAmount.HasValue)
                        {
                            <div class="summary-row">
                                <div class="summary-label">
                                    <i class="fas fa-undo"></i>
                                    Deposit Return
                                </div>
                                <div class="summary-value">
                                    <span class="amount-highlight">$@Model.PaymentCuongCla.DepositReturnAmount.Value.ToString("N2")</span>
                                </div>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.PaymentCuongCla.Notes))
                        {
                            <div class="summary-row">
                                <div class="summary-label">
                                    <i class="fas fa-sticky-note"></i>
                                    Notes
                                </div>
                                <div class="summary-value">
                                    @Model.PaymentCuongCla.Notes
                                </div>
                            </div>
                        }
                    </div>

                    <!-- Confirmation Checkbox -->
                    <div class="confirmation-checkbox">
                        <input type="checkbox" id="confirmDelete" required>
                        <label for="confirmDelete">
                            <i class="fas fa-check-square me-2"></i>
                            I understand that this action is permanent and cannot be undone
                        </label>
                    </div>

                    <!-- Delete Form -->
                    <form method="post" id="deleteForm">
                        <input type="hidden" asp-for="PaymentCuongCla.PaymentCuongClaid" />
                    </form>
                </div>

                <div class="delete-actions">
                    <div>
                        <a asp-page="./Index" class="btn-action btn-cancel">
                            <i class="fas fa-arrow-left me-2"></i>
                            Cancel & Go Back
                        </a>
                    </div>
                    <div>
                        <button type="button" id="deleteBtn" class="btn-action btn-delete" disabled>
                            <i class="fas fa-trash-alt me-2"></i>
                            Delete Payment
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Font Awesome (if not already included) -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- JavaScript for enhanced UX -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const confirmCheckbox = document.getElementById('confirmDelete');
        const deleteBtn = document.getElementById('deleteBtn');
        const deleteForm = document.getElementById('deleteForm');

        // Enable/disable delete button based on confirmation checkbox
        confirmCheckbox.addEventListener('change', function() {
            deleteBtn.disabled = !this.checked;
            if (this.checked) {
                deleteBtn.style.opacity = '1';
                deleteBtn.style.cursor = 'pointer';
            } else {
                deleteBtn.style.opacity = '0.6';
                deleteBtn.style.cursor = 'not-allowed';
            }
        });

        // Handle delete button click
        deleteBtn.addEventListener('click', function(e) {
            if (!confirmCheckbox.checked) {
                e.preventDefault();
                return;
            }

            // Show confirmation dialog
            if (confirm('Are you absolutely sure you want to delete this payment record? This action cannot be undone!')) {
                // Add loading state
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Deleting...';
                this.disabled = true;
                
                // Submit the form
                deleteForm.submit();
            }
        });

        // Prevent accidental form submission
        deleteForm.addEventListener('submit', function(e) {
            if (!confirmCheckbox.checked) {
                e.preventDefault();
                alert('Please confirm that you understand this action is permanent.');
                return false;
            }
        });

        // Add warning when user tries to leave without confirming
        window.addEventListener('beforeunload', function(e) {
            if (confirmCheckbox.checked) {
                e.preventDefault();
                e.returnValue = 'You have confirmed deletion but haven\'t completed the action. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
    });
</script>
